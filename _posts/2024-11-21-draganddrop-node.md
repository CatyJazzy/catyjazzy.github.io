---
title: ë“œë˜ê·¸ì•¤ë“œë¡­ìœ¼ë¡œ ë…¸ë“œ ê°„ ê°„ì„  ìƒì„±
date: 2024-11-21 10:00:00 +0900
categories: [Frontend]
tags: [React]
---

![á„€á…¡á†«á„‰á…¥á†¼á„‰á…¢á†¼á„‰á…¥á†¼.gif](%EB%93%9C%EB%9E%98%EA%B7%B8%EC%95%A4%EB%93%9C%EB%A1%AD%EC%9C%BC%EB%A1%9C%20%EB%85%B8%EB%93%9C%20%EA%B0%84%20%EA%B0%84%EC%84%A0%20%EC%83%9D%EC%84%B1/%25E1%2584%2580%25E1%2585%25A1%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25BC%25E1%2584%2589%25E1%2585%25A2%25E1%2586%25BC%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25BC.gif)

## ğŸ¤”Â ì´ˆê¸° êµ¬ìƒ

---

- ë…¸ë“œ ìƒì„± ë¡œì§ êµ¬í˜„í•œ ê²ƒì—ì„œ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì‹œ ì»¤ì„œ ìœ„ì¹˜ë¥¼ ê³„ì† ì¶”ì í•˜ê³  ìˆë‹¤.
- ê·¸ëŸ¼ DragEndì¼ ë•Œ ë“œë¡­ ì¢Œí‘œì— ë”°ë¼ ë¶„ê¸°ì²˜ë¦¬ë§Œ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?

ê°„ë‹¨í•˜ê²ŒëŠ” ì´ 2ê°œì˜ ë°©ë²•ì´ ë– ì˜¤ë¥¸ë‹¤.

**[1] drop ì¢Œí‘œë¥¼ ê³„ì‚°í•´ì„œ, spaceì— ê·¸ë ¤ì§„ ë…¸ë“œë“¤ì˜ ë²”ìœ„ë“¤ì„ ê³„ì‚° í›„ ìˆœíšŒí•˜ì—¬ ê²¹ì¹˜ëŠ” ê²ƒì´ ìˆëŠ”ì§€ ì‹ë³„í•˜ê¸°** 

**[2] Konvaì˜ ë°ëª¨ì— ìˆëŠ” hit detectionì„ í™œìš©í•´ì„œ ë…¸ë“œë¥¼ ì‚¬ê°í˜•ìœ¼ë¡œ ê°ì‹¸ê³ , haveIntersection ë©”ì†Œë“œ í™œìš©í•˜ê¸°**

ì§ê´€ì ìœ¼ë¡œ ìƒê°í•˜ê¸°ì—ëŠ” [1]ì´ íƒìƒ‰í•˜ê³  ì—°ì‚°í•˜ëŠ” ê³¼ì •ì´ ë§ì„ ê²ƒ ê°™ì€ë° ì‚¬ì‹¤ [2]ë„ ë‚´ë¶€ êµ¬í˜„ì„ ì˜ ëª¨ë¥´ê² ë‹¤. êµ¬í˜„ ë‚œì´ë„ê°€ ê°„ë‹¨í•œ ê²ƒì€ [2]ë¡œ ì˜ˆìƒë˜ë¯€ë¡œ, [2]ë¡œ ë¨¼ì € ì‹œë„í•´ë³´ì!

## ğŸÂ Have Intersection ì‚¬ìš©í•˜ê¸°

---

![image.png](%EB%93%9C%EB%9E%98%EA%B7%B8%EC%95%A4%EB%93%9C%EB%A1%AD%EC%9C%BC%EB%A1%9C%20%EB%85%B8%EB%93%9C%20%EA%B0%84%20%EA%B0%84%EC%84%A0%20%EC%83%9D%EC%84%B1/image.png)

```jsx
if (haveIntersection(group.getClientRect(), targetRect)) {
      group.findOne('.fillShape').fill('red');
    } else {
      group.findOne('.fillShape').fill('grey');
    }
```

**Client Rect**ê°€ ë­˜ê¹Œ? 

Konvaì˜ ê³µì‹ë¬¸ì„œì—ì„œëŠ” `getClientRect()ë©”ì†Œë“œ`ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì„¤ëª…í•œë‹¤. 

> Return client rectangle {x, y, width, height} of node. This rectangle also include all styling (strokes, shadows, etc). The purpose of the method is similar to getBoundingClientRect API of the DOM.
> 

íŠ¹ì • Konva ë…¸ë“œê°€ ì°¨ì§€í•˜ëŠ” **í´ë¼ì´ì–¸íŠ¸ ì˜ì—­**ì˜ í¬ê¸°ì™€ ìœ„ì¹˜ë¥¼ ë°˜í™˜í•œë‹¤. **ë·°í¬íŠ¸ë¥¼ ê¸°ì¤€**ìœ¼ë¡œ ì¸¡ì •í•˜ì—¬, **ìŠ¤íƒ€ì¼**( `stroke`, `shadow`, `transform` ë“±)ì„ í¬í•¨í•œ ì‹¤ì œ ì˜ì—­ì„ ê³„ì‚°í•´ì¤€ë‹¤. ë”°ë¼ì„œ, ë“œë˜ê³  ë˜ê³  ìˆëŠ” GooeyNodeì˜ ì¢Œí‘œ = dragPosition, í™”ë©´ì— ë Œë”ë§ëœ ê¸°ì¡´ ë…¸ë“œì˜ ì¢Œí‘œ = { x: node.x, y: node.y }ë¥¼ í™œìš©í•˜ë©´ ì‰½ê²Œ êµ¬í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

ì•„ë˜ì˜ ë¶‰ì€ í…Œë‘ë¦¬ê°€ getClientRectë¥¼ í†µí•´ í‘œì‹œëœ Konva ë…¸ë“œì˜ í¬ê¸°ì´ê³ , collisionì´ ê°ì§€ë˜ì—ˆì„ ë•Œ í•´ë‹¹ ë„í˜•ì„ ë¶‰ì€ ìƒ‰ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ì˜ˆì‹œë‹¤.

![[https://konvajs.org/docs/sandbox/Collision_Detection.html](https://konvajs.org/docs/sandbox/Collision_Detection.html)](%EB%93%9C%EB%9E%98%EA%B7%B8%EC%95%A4%EB%93%9C%EB%A1%AD%EC%9C%BC%EB%A1%9C%20%EB%85%B8%EB%93%9C%20%EA%B0%84%20%EA%B0%84%EC%84%A0%20%EC%83%9D%EC%84%B1/image%201.png)

[https://konvajs.org/docs/sandbox/Collision_Detection.html](https://konvajs.org/docs/sandbox/Collision_Detection.html)

**HoneyFlowì— ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.**

useDragNodeì»¤ìŠ¤í…€í›…ì— ìˆëŠ” dragEnd í•¸ë“¤ëŸ¬ í•¨ìˆ˜ì— ë‹¤ìŒì˜ ë¡œì§ì„ ì¶”ê°€í•œë‹¤. 

```tsx
function handleDragEnd() {

	// ë“œë˜ê·¸ ìƒíƒœì—ì„œ ì•„ë˜ì˜ ë‘ ì •ë³´ë¥¼ ì¶”ì¶œ 
	const { ë“œë˜ê·¸ì‹œì‘ë…¸ë“œ, ë“œë˜ê·¸ì¤‘ì¸ ì¢Œí‘œ } = dragState;
	
	// ë Œë”ë§ëœ nodeë¥¼ ìˆœíšŒí•˜ì—¬ haveIntersection ë©”ì†Œë“œë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰
	const overlapNode = nodes.find ( (node) => {
		
		const result = haveIntersection({ ë“œë˜ê·¸ì‹œì‘ë…¸ë“œì˜ getClientRectì •ë³´ }, 
		{ ë“œë˜ê·¸ì¤‘ì¸ gooeyë…¸ë“œì˜ getClientRectì •ë³´ });
		
		return result; 
	}

	// ê²¹ì¹˜ëŠ” ë…¸ë“œê°€ ìˆëŠ”ì§€ì— ë”°ë¼ ë¡œì§ ìˆ˜í–‰
	overlapNodeê°€ ìˆìœ¼ë©´ -> dropPosition null ì²˜ë¦¬ / ë‘ ë…¸ë“œì˜ ê°„ì„ ì„ ìƒì„±
	ì—†ìœ¼ë©´ -> ìƒˆë¡œìš´ ë…¸ë“œ ìƒì„± ë¡œì§
} 
```

ì´ë ‡ê²Œ í•˜ë©´ 1ì°¨ì ìœ¼ë¡œëŠ” ì˜ ì‘ë™í•˜ëŠ”ë°, **ì—£ì§€ì¼€ì´ìŠ¤**ì™€ **ì˜ìƒì—ì„œë„ ë³´ì´ëŠ” ë²„ê·¸**ë¥¼ ìƒê°í•´ë´ì•¼ í•œë‹¤.

![á„€á…¡á†«á„‰á…¥á†¼á„‰á…¢á†¼á„‰á…¥á†¼.gif](%EB%93%9C%EB%9E%98%EA%B7%B8%EC%95%A4%EB%93%9C%EB%A1%AD%EC%9C%BC%EB%A1%9C%20%EB%85%B8%EB%93%9C%20%EA%B0%84%20%EA%B0%84%EC%84%A0%20%EC%83%9D%EC%84%B1/%25E1%2584%2580%25E1%2585%25A1%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25BC%25E1%2584%2589%25E1%2585%25A2%25E1%2586%25BC%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25BC.gif)

- [x]  ìê¸° ìì‹ ìœ¼ë¡œ ì¬ê·€ì ìœ¼ë¡œ ë“œë¡­í–ˆì„ ë•Œ ê°„ì„ ì´ ì¶”ê°€ë˜ëŠ”ì§€?
- [x]  ì´ë¯¸ ê°„ì„ ì´ í‘œì‹œë˜ì–´ìˆëŠ” ë‘ ë…¸ë“œ ì‚¬ì´ë¥¼ ë“œë˜ê·¸&ë“œë¡­í–ˆì„ ë•Œ, ë“œë˜ê·¸ì‹œì‘-ë“œë¡­í•œ ìˆœì„œê°€ ë‹¬ë¼ì§€ë©´ ìƒˆë¡œìš´ ê°„ì„ ìœ¼ë¡œ ê°„ì£¼ë¨
- [ ]  *(+) ë‹¤ë¥¸ ë…¸ë“œì™€ ì¼ì • ë²”ìœ„ì—ì„œ ê°€ê¹Œì›Œì§€ë©´ Gooey Connection í‘œì‹œí•˜ëŠ” ê²ƒì´ ë³¸ë˜ ê¸°íšì— ë” ê°€ê¹Œì›€*

![á„€á…¡á†«á„‰á…¥á†«á„‰á…¢á†¼á„‰á…¥á†¼-á„‡á…¥á„€á…³1.gif](%EB%93%9C%EB%9E%98%EA%B7%B8%EC%95%A4%EB%93%9C%EB%A1%AD%EC%9C%BC%EB%A1%9C%20%EB%85%B8%EB%93%9C%20%EA%B0%84%20%EA%B0%84%EC%84%A0%20%EC%83%9D%EC%84%B1/%25E1%2584%2580%25E1%2585%25A1%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A2%25E1%2586%25BC%25E1%2584%2589%25E1%2585%25A5%25E1%2586%25BC-%25E1%2584%2587%25E1%2585%25A5%25E1%2584%2580%25E1%2585%25B31.gif)

## ğŸÂ Bug ì¡ê¸°â€¦ã… ã… 

---

ìœ„ì˜ ë¦¬ìŠ¤íŒ…í•œ ì´ìŠˆë“¤ ì¤‘ ìš°ì„ ìˆœìœ„ë¥¼ ì„ ì •í•´ë³´ì.

1. ê¸°ì¡´ ë…¸ë“œ ì‚¬ì´ì˜ ê°„ì„  ìƒì„±ì´ ë°”ë¡œ ì•ˆë˜ëŠ” ê²ƒ âœ…
2. ì´ë¯¸ ê°„ì„ ì´ ìˆëŠ” ë‘ ë…¸ë“œ ì‚¬ì´ì— ìƒˆë¡œìš´ ê°„ì„ ì´ ìƒì„±ë˜ëŠ” ê²ƒ âœ…
3. ìê¸° ìì‹ ìœ¼ë¡œ ë“œë¡­í–ˆì„ ë•Œì˜ ê°„ì„ ì´ ìƒì„±ë˜ëŠ” ê²ƒ âœ…

***ê¸°ì¡´ ë…¸ë“œ ì‚¬ì´ì˜ ê°„ì„  ìƒì„±ì´ ë°”ë¡œ ì•ˆë˜ëŠ” ê²ƒ***  âœ…

ê³„ì† ì‹œë„í•˜ë‹¤ë³´ë‹ˆ ì›ì¸ì„ ì°¾ì•˜ë‹¤. ë“œë¡­í•  ë•Œ í•œ ê°œì˜ ì›ë§Œ ê²¹ì¹˜ëŠ” ê²Œ ì•„ë‹ˆë¼â€¦ **ë‹¤ìˆ˜ì˜ ì›ì´ ê²¹ì¹  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—** ë°œìƒí•˜ëŠ” ë¬¸ì œë‹¤.

1. **ëŒ€ì‘ì±…ë“¤ì„ ìƒê°í•´ë³´ì.**

---

**(1) ë“œë¡­ ìœ„ì¹˜ê°€ ë‹¤ìˆ˜ì˜ ë…¸ë“œì™€ ì¤‘ì²©ë˜ë©´ ë…¸ë“œ ìƒì„± ë§‰ì•„ë²„ë¦¬ê¸°**

**(2) ë” ë§ì€ ì˜ì—­ì´ ê²¹ì¹œ ë…¸ë“œì™€ ì—°ê²°í•´ì£¼ê¸° (ì–¼ë§ˆë‚˜ ê²¹ì³¤ëŠ”ì§€ ë¹„êµí•  ìˆ˜ ìˆì–´ì•¼ í•¨, ë…¸ë“œì˜ ì¤‘ì‹¬ì  ê±°ë¦¬ë„ ë¹„êµí•  ìˆ˜ ìˆìŒ)**

ì–´ë–¤ ëŒ€ì‘ì±…ì„ ê³ ë¥´ë”ë¼ë„, ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ í‘œì§€ê°€ ìˆì–´ì•¼ í•  ê²ƒ ê°™ë‹¤. ì§€ê¸ˆ ì¤‘ì²©ë˜ê³  ìˆëŠ” ë…¸ë“œë“¤ì„ í‘œì‹œí•˜ê±°ë‚˜, ë” ê°€ê¹Œìš´ (ë“œë¡­ ì‹œ ì—°ê²°ë  ì˜ˆì •ì¸) ë…¸ë“œë¥¼ í‘œì‹œí•˜ëŠ” ê²ƒì´ë‹¤.

ì‚¬ìš©ì ê²½í—˜ì—ì„œëŠ” ì–´ë–¤ ê²ƒì´ ë” ì¢‹ì„ê¹Œ? Spaceì— ë…¸ë“œê°€ ë§ì•„ì§€ë©´, ì¤‘ì²©ë  ì¼ì´ ë§ì•„ì§ˆí…ë° ìƒì„± ìì²´ë¥¼ ë§‰ì•„ë²„ë¦¬ë©´ ê°„ì„  ìƒì„±ì´ ë„ˆë¬´ ì–´ë ¤ì›Œì§ˆ ê²ƒ ê°™ë‹¤. ë°˜ë©´, ìƒˆë¡œìš´ ë…¸ë“œë¥¼ ìƒì„±í•˜ê³  ì‹¶ì„ ë•Œ ê°„ì„  ìƒì„±ì´ ë„ˆë¬´ ì˜ë˜ë©´ ë¹ˆ ê³µê°„ì— ë“œë¡­í•˜ì—¬ ë…¸ë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë„ ì–´ë ¤ìš¸ ìˆ˜ë„ ìˆë‹¤. 

(ì•„ë‹ˆë‹¤,, í™”ë©´ì¡°ì‘ìœ¼ë¡œ Space í™”ë©´ì„ ì¶•ì†Œí•´ì„œ ë…¸ë“œë¥¼ ì¡°ì‘í•˜ë©´ ê´œì°®ì„ê¹Œ?) 

ê·¸ëŸ¼ ë¬´ì¡°ê±´ ë…¸ë“œê°€ ì¤‘ì²©ë˜ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼, ë“œë˜ê·¸í•˜ê³  ìˆëŠ” ì»¤ì„œ ìœ„ì¹˜ì™€ ê° ë…¸ë“œì˜ ì¤‘ì‹¬ì ì˜ ê±°ë¦¬ë¥¼ í•„ìˆ˜ì ìœ¼ë¡œ êµ¬í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤***. [ë‘ ë…¸ë“œì˜ ì¤‘ì²© + ì¼ì • ë²”ìœ„ ë‚´ì— ë“¤ì–´ì•¼ë§Œ ê°„ì„  ìƒì„±]ìœ¼ë¡œ ê°„ì„  ìƒì„± ì¡°ê±´ì„ êµ¬ì²´í™”***í•˜ëŠ” ê²ƒì´ë‹¤.

1. **ë“œë˜ê·¸ë˜ê³  ìˆëŠ” ìœ„ì¹˜ì— ì¤‘ì²©ë˜ê³  ìˆëŠ” ë…¸ë“œ í‘œì‹œí•´ì£¼ê¸°.**

---

*ì¼ë‹¨ ê°„ì„  ìƒì„±ì´ íŠ¸ë¦¬ê±°ë˜ëŠ” ì¡°ê±´ì€ íŒ€ì›ë“¤ì˜ ì¡°ì–¸ì„ êµ¬í•´ì„œ ë‹¤ì‹œ ìƒê°í•´ë³´ê³ , í˜„ì¬ ì¤‘ì²©ë˜ê³  ìˆëŠ” ë…¸ë“œë¥¼ í‘œì‹œí•´ì£¼ëŠ” ë¡œì§ë¶€í„° êµ¬í˜„í•´ë³´ì.*

- ì¼ë‹¨ nodesë°ì´í„°, Node ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë‘ SpaceView ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‹¤ë¤„ì§„ë‹¤.
- ë‹¤ë¥¸ ì»¤ìŠ¤í…€í›…ì—ì„œ ê´€ë¦¬í•˜ì—¬ node ë°ì´í„° ìƒíƒœë¥¼ ë°˜í™˜í•˜ê³ , ê·¸ ìƒíƒœë¥¼ useDragNode ì»¤ìŠ¤í…€í›…ì—ì„œ ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.
- ê·¸ëŸ¼ ë°˜ëŒ€ë¡œ useDragNodeì— ì •ì˜ë˜ì–´ìˆëŠ” **ë“œë¡­ í•¸ë“¤ëŸ¬ í•¨ìˆ˜**ì—ì„œ ë…¸ë“œì˜ ìŠ¤íƒ€ì¼ë§ì„ ë°”ê¾¸ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?

nodes ë°ì´í„° ìƒíƒœë¥¼ ë‹¤ë£¨ëŠ” í•¨ìˆ˜ë¥¼ ë°›ì•„ì„œ í™œìš©í•œë‹¤ê³  í•˜ë”ë¼ë„ â€¦ ë°ì´í„° ì•ˆì—ëŠ” ìŠ¤íƒ€ì¼ë§ ê´€ë ¨ëœ ë‚´ìš©ì„ ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì¥ ë– ì˜¤ë¥´ëŠ” ìµœì„ ì˜ ë°©ì‹ì€ *ë“œë˜ê·¸ ì¤‘ì¸ íŠ¹ì • ìƒí™©ì¼ ë•Œë§Œ GooeyNode ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼, ê°„ì„  ìƒì„±í•˜ê³ ì í•˜ëŠ” ì¤‘ì²©ëœ ë…¸ë“œê°€ ìˆì„ ë•Œë§Œ indicator ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•´ì£¼ëŠ” ê²ƒ*ì´ë‹¤.

***ì´ë¯¸ ê°„ì„ ì´ ìˆëŠ” ë‘ ë…¸ë“œ ì‚¬ì´ì— ìƒˆë¡œìš´ ê°„ì„ ì´ ìƒì„±ë˜ëŠ” ê²ƒ*** âœ…

ì´ê±´ ê°„ì„ ì´ ìƒì„±ë˜ëŠ” ë¡œì§ì—ì„œ ê²€ì‚¬í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ë‹¤ê³  ìƒê°í–ˆë‹¤. ì¼ë‹¨ dragEndí•¸ë“¤ëŸ¬ì—ì„œëŠ” ê·¸ëŒ€ë¡œ createEdgeí•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.

ëŒ€ì‹  createEdgeí•¨ìˆ˜ì— ì´ë¯¸ í¬í•¨ëœ ê°„ì„ ì¸ì§€ ê²€ì‚¬í•˜ëŠ” ê³¼ì •ì„ ì¶”ê°€í•œë‹¤. ì´ë•Œ (from: A, to: B), (from: B, to: A) ë‘ ê°€ì§€ ê²½ìš°ëŠ” ë‘ ë…¸ë“œì˜ ìˆœì„œê°€ ë‹¬ë¼ë„ ê°™ì€ ê°„ì„ ì„ ì˜ë¯¸í•˜ë¯€ë¡œ ìˆœì„œê°€ ë°˜ëŒ€ì¼ ë•Œë„ ì²´í¬í•œë‹¤.

```tsx
 const isSameEdgeExist = edges.some(
        (edge) =>
          (edge.from.id === toNode.id && edge.to.id === fromNode.id) ||
          (edge.from.id === fromNode.id && edge.to.id === toNode.id),
      );

      if (isSameEdgeExist) return;
```

***ìê¸° ìì‹ ìœ¼ë¡œ ë“œë¡­í–ˆì„ ë•Œì˜ ê°„ì„ ì´ ìƒì„±ë˜ëŠ” ê²ƒ* âœ…**

í¬ê°œì§„ ë…¸ë“œì˜ Idê°€ ë“œë˜ê·¸ê°€ ì‹œì‘ëœ ë…¸ë“œ Idì™€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ë•Œë§Œ ê°„ì„ ì´ ìƒì„±ë˜ë„ë¡ ë³€ê²½í•˜ë©´ ëœë‹¤.

```tsx
 if (overlapNode && **overlapNode.id !== startNode.id**) {
      setDropPosition(null);
      spaceActions.createEdge(startNode, overlapNode);
    }
```